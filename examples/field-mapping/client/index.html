<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Field Room - Collaborative Workspace</title>

  <!-- Leaflet.js CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin="">

  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <!-- Auth overlay -->
  <div id="auth-overlay">
    <div id="auth-form">
      <h2>Join Field Room</h2>
      <input type="text" id="username" placeholder="Your name" autofocus />
      <button id="join-btn">Join</button>
    </div>
  </div>

  <!-- Main interface -->
  <div class="container">
    <!-- Text Column (Chat) -->
    <div class="text-column" id="text-column">
      <header class="header">
        <h1>Field Room</h1>
        <span class="connection-status" id="status">Disconnected</span>
      </header>

      <!-- Command Reference Panel -->
      <div class="command-panel" id="command-panel">
        <div class="command-group">
          <span class="command-group-title">üìç Location</span>
          <span class="cmd" data-suggest="@{ai} survey the area around {location}" data-location="true" title="Analyse the selected location">survey</span>
          <span class="cmd" data-suggest="@{ai} what planning constraints apply near {location}?" data-location="true" title="Check planning data">planning</span>
          <span class="cmd" data-suggest="@{ai} what's nearby {location}?" data-location="true" title="Points of interest">nearby</span>
          <span class="cmd" data-suggest="@{ai} research the history of {location}" data-location="true" title="Historical research">history</span>
        </div>
        <div class="command-group">
          <span class="command-group-title">üí¨ General</span>
          <span class="cmd" data-suggest="@{ai} summarize our discussion" data-location="false" title="Get conversation summary">summarize</span>
          <span class="cmd" data-suggest="@{ai} " data-location="false" title="Ask anything">ask...</span>
          <span class="cmd" data-suggest="/goto " data-location="false" title="Jump to a place">/goto</span>
          <span class="cmd" data-suggest="/help" data-location="false" title="Show help">/help</span>
        </div>
      </div>

      <!-- Chat Output -->
      <main class="output" id="output">
        <p class="system-message">Welcome to Field Room, a collaborative workspace with AI assistance.</p>
        <p class="system-message">Connecting to server...</p>
      </main>

      <!-- Presence -->
      <div id="presence">
        <h3>Online</h3>
        <div id="presence-list"></div>
      </div>

      <!-- Input Area -->
      <footer class="input-area">
        <form id="command-form">
          <input
            type="text"
            id="command-input"
            placeholder="Type a message or @{ai} to invoke AI..."
            autocomplete="off"
            autofocus
            disabled
          >
          <button type="submit">&gt;</button>
        </form>
      </footer>
    </div>

    <!-- Resize Handle: Columns -->
    <div class="resize-handle resize-handle-h" id="resize-handle-columns"></div>

    <!-- Right Column: Map + Auxiliary Panel -->
    <div class="right-column" id="right-column">
      <!-- Location Display -->
      <div class="location-bar" id="location-display">
        <div class="location-primary">Click on the map to select a location</div>
      </div>

      <!-- Map Section -->
      <div class="map-section" id="map-section">
        <div id="map"></div>

        <!-- Coordinates overlay -->
        <div class="coords-overlay" id="coords-display">‚Äî</div>
      </div>

      <!-- Resize Handle: Map/Panel -->
      <div class="resize-handle resize-handle-v" id="resize-handle-panels"></div>

      <!-- Auxiliary Panel -->
      <div class="aux-panel" id="aux-panel">
        <div class="aux-panel-tabs" id="aux-panel-tabs">
          <button class="aux-tab active" data-tab="activity" title="Activity feed">üìú</button>
          <button class="aux-tab" data-tab="users" title="Users online">üë•</button>
          <button class="aux-tab" data-tab="help" title="Help">‚ùì</button>
        </div>
        <div class="aux-panel-content" id="aux-panel-content">
          <div class="aux-panel-placeholder">
            <span class="placeholder-text">Select a tab above</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Leaflet.js -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>

  <script>
    // Auto-detect sync service URL from the page host
    window.FIELD_ROOM_SYNC_URL = 'ws://' + window.location.hostname + ':3738';
    window.FIELD_ROOM_AI_USER = 'pauline';
  </script>
  <script src="client.js" type="module"></script>
</body>
</html>
